<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Drive Uploader</title>
  <script src="https://cdn.jsdelivr.net/npm/jsrsasign"></script> <!-- brings in signing library -->
</head>
<body>
  <h1>Upload to Google Drive</h1>

  <input type="file" id="fileInput">
  <button onclick="uploadFile()">Upload</button>

  <pre id="output"></pre>

  <script>
    // Your service account credentials
    const SERVICE_ACCOUNT = {
      private_key: `-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDqbsrqkrWbYs7B
hbNWirJlQpCui+FMLxFI+cB0+xP6ZrnU3ylzWRyrzlMPMUu+HsXaUsfeLNr+wZYp
FnSDHC3jyg0i+FOd7RtCp5B/BNZo65UdusKdrlMqIaAGzFhcudmbw+9W1WYi72/c
IuVfdeiWpiRqUml26cugk1BOGoGP/N12EbADMLf3xKHjn/AWIjG0DKz9QExVuPk1
bUCXIiiIiwzr3OwP3r/txzWEexpSSvpOV138IBKvyjaCRJNsz/ak1EsXpq3nuTUn
W0lH2z7A+eOefXScdGgec9DCggU29GGCTGwkbbjPMpOMpGt1JHXED7wR5amhPu3U
ZKm2rzpJAgMBAAECggEAMGeNasc9i7aoWaFtUNhk8s7+eCfGLliGkWKOGClSa/Cj
fJ5SXPCAoMHCeR/U043fjM9sWMW6twDKLDQofPzHxeGNelO7Uh+nsgjOp0dcrP+9
g4yxC+U3Yzrbo6O0N/sgwQ6A/9UimGKHXnTvFtmN23M1ECXxhD3MT1yzZ1kGOPAY
G5I7j4Tb1ie3bPyDAQRNxpB9hL76i/OvWyI63GoaMbx+6RC+6Kt8jiFP1E7b6vx7
w+rKZ2b9eq4zV+pZnd2FdbdBBfg8L9aYOthfvrdpKYifRuAWzQ7GGtJFrXsILdoO
p9p4Fo1ErJDJpE0qb8GRObaJ40lm++bAUs4lpbyA/QKBgQD/C/28SRvkwFXjEp7d
GkYNnO3iGPqXSqJUKvFDihwnakINDqiDwgiFEmHcV7EFvX2pVdlPSDHRAtJ5vt0w
3KFzw4k98KadYG7lyPK60yXb+ZPY48LdytLm5Uo7cpVGRuKHyxZj7PckoS31rNHr
jbtu3a9HJy/L1RZXqeoZDYFCvQKBgQDrTxRe2RN4a/t84IJSElfrQwBZ5Ytrw5FJ
jMieKtNR2efNlRWlgI3zznaA4LlfATTrJNYUOTCNyAvN/u6PxQERUnpzqZ4xDrGi
/omAU6obprdfC1o6s7qUALd+1RB0x5H9ZciaosCnkJuNxK2K6UdEbUsoRtVI7Byz
l7DgTOR0fQKBgEUAtoZxdTV/f/0udYK2cAuQ0J9iSLIUBDUnZRzzycg0LGih9Z+o
KGvwXD+kDgXSjaP50RBtJOU6kT1VETz+BERwu7nhWQKtK3PJ2ToIlG6eaIy+mmMt
U8Aaeun4h0B7PyCkJoukef0UCn40YpsLPpGxMpHanUjVfvT6yJY8nCM1AoGBAJ/s
Xf7cb9QvJ3vGpiubVe+J2OpADNKP1uVy7kI4/ugpPdbGFTEnPtLNplKO6M1953ZM
0cZq2+nwZL17Hq3NiZ05Pgnv5JiY0PfjIJZ7xigG1aed8pPk5NCD8DIeIpILtNfQ
Xldid6cqq93dJsk7JHmIAkV8Zqap+hPA67B18eqNAoGAcYUZsIWdhAK7tj8PIzHf
bgbR3K5SyjknDKG/g+MaMyjS/xu0wkuov4GGn3L6tjMMItySHVuX4rAsKI5MsDN4
0jaRsOt+OT2RBtcMN6+DF77JWHLcMckaG8C1+BazJ4og83kY7aXjcWIad3XNqqO3
+Sl4Yqngrg6FBjREC4VyM98=
-----END PRIVATE KEY-----`,
      client_email: "googledriveuploader@voicerecorder-456703.iam.gserviceaccount.com"
    };

    async function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) {
        alert("Please select a file first.");
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = async function (e) {
        const fileData = new Uint8Array(e.target.result);

        try {
          const jwt = createJWT();
          const tokenResponse = await fetch('https://oauth2.googleapis.com/token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&assertion=${jwt}`
          });

          const tokenJson = await tokenResponse.json();
          const accessToken = tokenJson.access_token;

          const metadata = {
            name: file.name,
            parents: ['1tvoQALyZeQ1Db_QwPHysY0x5xQQDSOAM']
          };

          const form = new FormData();
          form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
          form.append('file', new Blob([fileData]));

          const uploadResponse = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
            method: 'POST',
            headers: { 'Authorization': 'Bearer ' + accessToken },
            body: form
          });

          const uploadJson = await uploadResponse.json();
          document.getElementById('output').innerText = JSON.stringify(uploadJson, null, 2);
        } catch (error) {
          console.error(error);
          document.getElementById('output').innerText = 'Upload failed: ' + error;
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function createJWT() {
      const header = { alg: 'RS256', typ: 'JWT' };
      const now = Math.floor(Date.now() / 1000);
      const claim = {
        iss: SERVICE_ACCOUNT.client_email,
        scope: 'https://www.googleapis.com/auth/drive.file',
        aud: 'https://oauth2.googleapis.com/token',
        exp: now + 3600,
        iat: now
      };

      const sHeader = JSON.stringify(header);
      const sClaim = JSON.stringify(claim);
      const key = KEYUTIL.getKey(SERVICE_ACCOUNT.private_key);
      return KJUR.jws.JWS.sign("RS256", sHeader, sClaim, key);
    }
  </script>
</body>
</html>
